build-steps:
  - install:
      type: script
      script:
        # Need to quiet composer so that the logs aren't 6 million chars
        - composer install --no-interaction
        # Sudo used to start database as root. Only command that can use Sudo in container.
        - sudo /etc/init.d/mysql start
        # Create database for new Drupal install. Settings.php can't have creds in it, otherwise Drupal throws AlreadyInstalledException
        - mysql -u root -proot -e "CREATE DATABASE drupal"
        # Move to the docroot to run drush
        - cd docroot
        # Use drush to install the default profile. Change if you want different drush arguments. Mysql must be on 127.0.0.1. Silencing a drush si mail issue. Pass in newly created database called drupal
        - /usr/bin/env PHP_OPTIONS="-d sendmail_path=`which true`" ../vendor/bin/drush site-install -y --db-url=mysql://root:root@127.0.0.1:3306/drupal
        # Use php webserver as this is known to work in the container. Wait 2 seconds for PHP server to get set-up.
        - php -S 127.0.0.1:8081 &
        - sleep 2
        # Move out of the docroot so behat doesn't lose it's way. Will run behat with default settings using behat.yml and then terminate when the feature files are done.
        - cd ..
        - ./vendor/bin/behat
variables:
  global:
    HIPCHAT_TOKEN:
      secure: 2acy85dnsu+U6XG1ruKBehcuTnL3Qic4jsUt9lDKb0UV1iFwdU9NwX6u8EMQh1Pos1BznFFDt/mbJ7q4oSs4z/nQbbyn43fAZ1NRdS3UEo4hwfjL89kTF+90JdYWSd5e62yEbD7f30n15BZ3r49brockkY6ERDeZ1+OpCiVMf8NazSvMVw6H8ahzj1Bd1gd9DXZQCOLbodNLHqigIcfDXj8loX6YGIYJYPFBlH9vFj5exT0qbd7XTIRMyv+TiohzHl0yOPwVSXONb9TWZsvaXWgXZpgL+iFFZ7f5Pl9hNgBFo6vQXu+604A5wlVroS9bpHJIkXpMltmJufpgStuLIPgCqQVZkbQnuXuoFEoCLpWL6mCNVmDZPoUl1KOakL/Y/AVt9TlUAU8P729HMc6XK/7bqTgThEQ4OAJ+xYuDNm9f0Fq/RGhr7I3YV7wCy02Ruxa7IDHKlk+1nclYUQpnLNzW8ligOK1t9pjeMzVdBgaf4rR3zXTh919L0H+sk4zibK90ZuiS3TRSe3TQe23lMNPaixCQcYAx9Vmw8l3DmUTiMieHkpfpTTXRczIxl633BNO4K2a9kc0Am+wbLcatrVddiPQzr3VS5Z7XO1YbNNzpBQwt6ewTPVXOdG9iM++ZvOHoe2bOJn3aRi3ynPq6nG6BJubOS6Telof9P7lSO47Tcc=D6WoYvnd68S83pHUkyfPKWbNCuwAsF5nq5bsM+nqVQVgwYdHG5Y5eCZjq1wVPuYi
